<!--
## Copyright (C) <2017>  <bioMerieux, Universite Claude Bernard Lyon 1,
## Centre National de la Recherche Scientifique>

## 1. This program is free software: you can redistribute it and/or modify
## it under the terms of the GNU Affero General Public License as published
## by the Free Software Foundation version 3 of the  License and under the
## terms of article 2 below.
## 2. This program is distributed in the hope that it will be useful, but
## WITHOUT ANY WARRANTY; without even the implied warranty of MERCHANTABILITY
## or FITNESS FOR A PARTICULAR PURPOSE. See below the GNU Affero General
## Public License for more details.
## You should have received a copy of the GNU Affero General Public License
## along with this program.  If not, see <http://www.gnu.org/licenses/>.
## 3. Communication to the public by any means, in particular in the form of
## a scientific paper, a poster, a slideshow, an internet page, or a patent,
## of a result obtained directly or indirectly by running this program must
## cite the following paper :
##  Magali Jaillard, Maud Tournoud, Leandro Lima, Vincent Lacroix,
##  Jean-Baptiste Veyrieras and Laurent Jacob, "Representing Genetic
##  Determinants in Bacterial GWAS with Compacted De Bruijn Graphs", 2017,
##  Cold Spring Harbor Labs Journals, doi:10.1101/113563.
##  (url: http://www.biorxiv.org/content/early/2017/03/03/113563)
## -------------------------------------------------------------------------

## Authors (alphabetically): Jacob L., Jaillard M., Lima L.
-->

<!DOCTYPE html>
<html>
<head>
    <meta charset=utf-8 />
    <link rel="stylesheet" href="components/lib/css/bootstrap.min.css">
    <link rel="stylesheet" href="components/lib/css/query-builder.default.min.css">
    <style>
        img {
            max-width: 200px;
            height: auto;
        }

        <!-- table{ -->
        <!--     border: 1px solid black; -->
        <!--     border-collapse: collapse; -->
        <!-- } -->
	
	tr:nth-child(even) {background-color: #f2f2f2}
	
        <!-- td,tr{ -->
        <!--     border: 1px solid gray; -->
        <!--     border-collapse: collapse; -->
        <!-- } -->
	
	th {
	background-color: #31708F;
	color: white;
	}
	
        .centeredbtn{
            margin:auto;
            display:block;
            width: 50%;
        }
    </style>



    <script src="components/lib/js/jquery.min.js"></script>
    <script src="components/lib/js/query-builder.standalone.min.js"></script>
    <script src="components/lib/js/alasql.min.js"></script>
    <script type="text/javascript">
        var data;

        function buildObjectsHTML(objects) {
            var html="";
            var nb=0;
            objects.forEach(function(object) {
                html += object.preview + "\n";
                nb += 1;
            });
            return "<h3>Done! Found " + nb + " components.</h3><br/><br/>" + html;
        }

        function showObjects() {
            var objectDiv = $('#showItemsDiv');
            objectDiv.html('Working...');
            var sql = 'SELECT preview FROM ? WHERE ' + $('#builder').queryBuilder('getSQL', false).sql + ' ORDER BY ' + $('#sortTerm').val() + ' ' + $('#asc_desc').val();
            var objects = alasql(sql, [data]);
            objectDiv.html(buildObjectsHTML(objects));
        }
    </script>
    <title>Your DBGWAS results</title>
</head>
<body>
<h1>Your DBGWAS results</h1>


<div style="margin:0 auto; width:60%;">
    <h3> Filters: </h3>
    <div id="builder"></div>

    <script>
        $( document ).ready(function() {
            //auto generated stuff comes here
            data = <previews>
            //auto generated stuff comes here

            var queryBuilder = $('#builder').queryBuilder({
                filters: [
                    {id: 'qvalue', type: 'string', label: 'q-value', input: 'text', operators: ['equal', 'not_equal', 'less', 'less_or_equal', 'greater', 'greater_or_equal', 'between']},
                    {id: 'annotations', type: 'string', label: 'Annotations', input: 'select', operators: ['contains', 'not_contains'], values: <all_genes_in_all_components>}
                ],
                rules: [{
                    condition: 'AND',
                    id: 'qvalue',
                    operator: 'between',
                    value: ['0.0', '1.0']
                }]
            });

            showObjects();
        })
    </script>

    <h3> Sort by:
        <select id="sortTerm">
            <option value="qvalue" selected>q-value</option>
        </select>
        <select id="asc_desc">
            <option value="ASC" selected>Asc</option>
            <option value="DESC">Desc</option>
        </select>
    </h3>

    <br/>
    <button type="button" class="centeredbtn" onclick="showObjects()">Apply</button>
    <br/>
</div>
<br/>
<br/>

<div id="showItemsDiv"></div>

</body>
</html>
